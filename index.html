<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Email Tempor√°rio + Conta</title>
</head>
<body>
  <h1>Gerar Conta com Email Temp</h1>
  <button onclick="gerarConta()">üé≤ Gerar Conta</button>

  <div id="info" style="margin-top:20px;"></div>
  <div id="emails" style="margin-top:20px;"></div>

  <script>
    let token = null;

    async function gerarConta() {
      const res = await fetch('/gerar_conta');
      const data = await res.json();
      
      if (data.error) {
        document.getElementById('info').innerHTML = `<p>‚ùå ${data.error}</p>`;
        return;
      }

      token = data.token;
      document.getElementById('info').innerHTML = `
        <p><strong>Usu√°rio:</strong> ${data.usuario}</p>
        <p><strong>Senha:</strong> ${data.senha}</p>
        <p><strong>Email:</strong> ${data.email}</p>
        <button onclick="verificarEmails()">üì• Verificar Emails</button>
      `;
    }

    async function verificarEmails() {
      if (!token) return;
      const res = await fetch(`/verificar_emails/${token}`);
      const data = await res.json();

      if (data.expired) {
        document.getElementById('emails').innerHTML = "<p>‚ò†Ô∏è Caixa de entrada expirada.</p>";
        return;
      }

      if (data.emails.length === 0) {
        document.getElementById('emails').innerHTML = "<p>Nenhum email recebido ainda.</p>";
        return;
      }

      let html = "<h2>üì• Emails:</h2>";
      data.emails.forEach(email => {
        html += `
          <hr>
          <p><strong>De:</strong> ${email.from}</p>
          <p><strong>Assunto:</strong> ${email.subject}</p>
          <p><strong>Mensagem:</strong> ${email.body || 'Sem conte√∫do'}</p>
        `;
      });

      document.getElementById('emails').innerHTML = html;
    }
  </script>
</body>
</html>
