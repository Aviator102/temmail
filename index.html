<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gerador de Conta + Email Temp</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .dados, .emails { margin-top: 20px; }
    button { padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>

  <h1>Gerador de Conta com Email Temp</h1>

  <button onclick="gerarConta()">üé≤ Gerar Conta</button>

  <div class="dados" id="dados" style="display:none;">
    <p><b>Usu√°rio:</b> <span id="usuario"></span></p>
    <p><b>Senha:</b> <span id="senha"></span></p>
    <p><b>Email:</b> <span id="email"></span></p>
    <button onclick="verificarEmails()">üì• Verificar Emails</button>
  </div>

  <div class="emails" id="emails"></div>

  <script>
    let tokenGlobal = null;

    async function gerarConta() {
      const res = await fetch('/gerar_conta');
      const data = await res.json();

      if (data.error) {
        alert(data.error);
        return;
      }

      document.getElementById('usuario').textContent = data.usuario;
      document.getElementById('senha').textContent = data.senha;
      document.getElementById('email').textContent = data.email;
      document.getElementById('dados').style.display = 'block';

      tokenGlobal = data.token;
      document.getElementById('emails').innerHTML = '';
    }

    async function verificarEmails() {
      if (!tokenGlobal) return;

      const res = await fetch(`/verificar_emails/${tokenGlobal}`);
      const data = await res.json();

      if (data.expired) {
        document.getElementById('emails').innerHTML = "<p>‚ò†Ô∏è A caixa expirou.</p>";
        return;
      }

      if (data.emails && data.emails.length > 0) {
        let html = "<h3>üì• Emails Recebidos:</h3>";
        data.emails.forEach(email => {
          html += `
            <hr>
            <p><b>De:</b> ${email.from}</p>
            <p><b>Assunto:</b> ${email.subject}</p>
            <p><b>Corpo:</b> ${email.body || "Sem corpo"}</p>
          `;
        });
        document.getElementById('emails').innerHTML = html;
      } else {
        document.getElementById('emails').innerHTML = "<p>Nenhum email ainda.</p>";
      }
    }
  </script>

</body>
</html>
